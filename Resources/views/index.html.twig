<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
</head>
<body>
<h1>Kimai -&gt; Trello Plugin</h1>
Goto plugin admin.
<script src="https://p.trellocdn.com/power-up.min.js"></script>
<script>
    // we can access Bluebird Promises as follows
    window.Promise = TrelloPowerUp.Promise;

TrelloPowerUp.initialize({
    'card-buttons': function(t, opts) {
        return t.get('member', 'private', 'token')
            .then(function(token){
                return [{
                    icon: 'https://tobias.neontribe.co.uk/bundles/trello/kimai-grey.png',
                    text: 'Kimai',
                    callback: function(context) {
                        // This is a temp solution that works but if you're not logged into kimai it shows the log in page an post login.
                        // We need to check if this URL gives a 403, and if it does then display this page instead:
                        //  {{ path('trello_login', {}, relative = false) }}
                        return context.popup({
                            title: 'Log Time',
                            url: "{{ url('trello_logtime', { projectId: 123, cardId: 456 }) }}",
                            height: 500
                        });
                    }
                }];
            });
    },
    'card-back-section': function(t, opt){
        t.card('shortLink').then(function (shortLink) {
            alert(shortLink['shortLink']);
        });
        t.board('shortLink').then(function (shortLink) {
            alert(shortLink['shortLink']);
        });
        return {
                  icon: 'https://tobias.neontribe.co.uk/bundles/trello/kimai-grey.png',
                  title: 'Time logged',
                  content: {
                      type: 'iframe',
                      url: "{{ url('trello_loggedtime', { cardId: 456 }) }}",
                      height: 100 // Max height is 500
                  }
                };
    }
});
</script>
</body>
</html>
